<!DOCTYPE html>
<html>
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <head>
      <title> LAMBooksDB </title>
      <link rel="icon" href="/images/icon_website.png">
      <link rel="stylesheet" href="/stylesheets/Page_template_style.css">
   </head>

   <body>
      <div id="header">
         <span onclick="openNav()">
            <div class="menu_icon">
               <div class="line"></div>
               <div class="line"></div>
               <div class="line"></div>
            </div>
            <script>
               function closeNav() {
                  document.getElementById("Sidebar_menu").style.width = "0";
                  document.getElementById("main").style.marginLeft = "0";
                  document.body.style.backgroundColor = "#403C3C";
               }
            </script>
         </span>
         <div id="title"> LAMbooksDB </div>
      </div>

      <div id="Sidebar_menu" class="sidenav">
         <a href="javascript:void(0)" class="close_menu" onclick="closeNav()">&times;</a>
         <script>
            function openNav() {
               document.getElementById("Sidebar_menu").style.width = "15%";
               document.getElementById("main").style.marginLeft = "10%";
               document.body.style.backgroundColor = "rgba(0,0,0,0.4)";
            }
         </script>
         <a href="Read.html"> Read </a>
         <a href="/toread"> My List </a>
         <a href="Suggested.html"> Suggested </a>
         <a href="#" class="categories_dropdown closed" onclick="dropdown()"> Categories </a>
            <a href="#" class="literary_genres hidden"> Giallo </a>
            <a href="#" class="literary_genres hidden"> Rosa </a>
            <a href="#" class="literary_genres hidden"> Saggistica </a>
            <a href="#" class="literary_genres hidden"> Favole </a>
            <a href="#" class="literary_genres hidden"> Horror </a>
            <a href="#" class="literary_genres hidden"> Azione </a>
            <a href="#" class="literary_genres hidden"> Avventura </a>
            <a href="#" class="literary_genres hidden"> Biografia </a>
            <a href="#" class="literary_genres hidden"> Autobiografia </a>
            <a href="#" class="literary_genres hidden"> Storico </a>
      </div>
      <script>
         function dropdown() {
            var menu = document.querySelector('.categories_dropdown');
            var categories = document.querySelectorAll('.literary_genres');

            if (menu.classList.contains('closed')) {
               menu.classList.remove('closed');
               categories.forEach( (cat) => {
                  cat.classList.remove('hidden');
               });
            } else {
               menu.classList.add('closed');
               categories.forEach( (cat) => {
                  cat.classList.add('hidden');
               });
            }
         }
      </script>

      <form>
         <label for="search">Search</label>
         <input id="search" type="search" pattern=".*\S.*" required>
         <span class="caret"></span>
      </form>

      <div class="content-block">
        <h2><%=name%>'s books to read</h2>
        <% if (typeof message !== 'undefined') { %>
            <p><%= message %></p>
        <% } %>
        <% if (typeof list !== 'undefined') { %>
            <div class="list_books">
            </div>
            <button id='load'>Load more</button>
            <script>
                var books = <%-list%>;
                var listBooks = document.querySelector('.list_books');
                var i=0;
                for (; i<5; i++) {
                    let newContainer = newBookContainer(books[i]);
                    listBooks.appendChild(newContainer);
                }
                let loadButton = document.getElementById('load');
                loadButton.addEventListener('click', () => {
                    let numElements = i + 5;
                    for (; i<numElements && i < books.length; i++) {
                        let newContainer = newBookContainer(books[i]);
                        listBooks.appendChild(newContainer);
                    }
                    if (i === books.length)
                        loadButton.remove();
                });

                function newBookContainer(book) {
                    let newContainer = document.createElement('div');
                    newContainer.className = 'book-container';

                    let thumbnail = document.createElement('div');
                    thumbnail.className = 'thumbnail';
                    thumbnail.innerHTML = '<img src="/images/sapiens.jpeg">';

                    let infoContainer = document.createElement('div');
                    infoContainer.className = 'info-container';

                    let p = document.createElement('p');
                    infoContainer.className = 'info-title';
                    p.appendChild(document.createTextNode(book.title));
                    infoContainer.appendChild(p);

                    p = document.createElement('p');
                    infoContainer.className = 'info-isbn';
                    p.appendChild(document.createTextNode(book.isbn));
                    infoContainer.appendChild(p);

                    newContainer.appendChild(thumbnail);
                    newContainer.appendChild(infoContainer);
                    return newContainer;
                }
            </script>
        <% } %>
      </div>
   </body>
</html>