<h2>Results of the search for "<%=search%>":</h2>
<% if (typeof message !== 'undefined') { %>
   <p><%= message %></p>
<% } %>
<% if (typeof list !== 'undefined') { %>
   <div class="list_books">
   </div>
   <button id='load'>Load more</button>
   <script>
      var books = <%-list%>;
      var listBooks = document.querySelector('.list_books');
      var i=0;
      for (; i<5; i++) {
         let newContainer = newBookContainer(books[i]);
         listBooks.appendChild(newContainer);
      }
      let loadButton = document.getElementById('load');
      loadButton.addEventListener('click', () => {
         let numElements = i + 5;
         for (; i<numElements && i < books.length; i++) {
            let newContainer = newBookContainer(books[i]);
            listBooks.appendChild(newContainer);
         }
         if (i === books.length)
            loadButton.remove();
      });

      function newBookContainer(book) {
         let newContainer = document.createElement('div');
         newContainer.className = 'book-container';

         let thumbnail = document.createElement('div');
         thumbnail.className = 'thumbnail';
         if (book.thumbnail?.smallThumbnail)
            thumbnail.innerHTML = `<img src="${book.thumbnail.smallThumbnail}">`;
         else if (book.thumbnail?.thumbnail)
            thumbnail.innerHTML = `<img src="${book.thumbnail.thumbnail}">`;
         else 
            thumbnail.innerHTML = '<img src="/images/sapiens.jpeg">';

         let infoContainer = document.createElement('div');
         infoContainer.className = 'info-container';

         let title = document.createElement('p');
         title.className = 'info-title';
         title.appendChild(document.createTextNode(trimTitle(book.title)));
         infoContainer.appendChild(title);

         let authors = document.createElement('p');
         authors.className = 'info-authors';
         authors.appendChild(document.createTextNode(book.authors ? book.authors : "Unknown author"));
         infoContainer.appendChild(authors);

         newContainer.appendChild(thumbnail);
         newContainer.appendChild(infoContainer);

         let forms = document.createElement('div');
         forms.className = 'addToList-buttons';
         let formToRead = document.createElement('form');
         formToRead.method = 'POST';
         formToRead.action = '/search/add/toread';
         let input = document.createElement('input');
         input.type = 'hidden';
         input.name = 'book';
         input.value = JSON.stringify(book); //book.isbn[0]?.identifier ?? book.isbn[1]?.identifier;
         let submitBtn = document.createElement('button');
         submitBtn.innerText = 'to read';
         if (book.toRead) {
            submitBtn.disabled = true;
         }
         formToRead.appendChild(input);
         formToRead.appendChild(submitBtn);
         newContainer.appendChild(formToRead);

         return newContainer;
      }

   function trimTitle(originalTitle) {
      if (originalTitle.length > 100) {
         return originalTitle.substring(0, 99) + "...";
      } else {
         return originalTitle;
      }
   }
   </script>
<% } %>